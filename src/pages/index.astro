---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<main class="max-w-4xl mx-auto px-6 py-12">
		<h1 class="text-2xl font-normal mb-12 text-[var(--text)]">画像変換</h1>

		<section>
			<div id="dropzone" class="border-2 border-dashed border-[var(--border)] rounded-lg p-16 cursor-pointer outline-none transition-colors hover:border-[var(--text)] text-center" role="button" tabindex="0" aria-label="画像をドロップ または クリックして選択">
				<svg class="w-12 h-12 mx-auto mb-4 text-[var(--muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
				</svg>
				<div class="text-base text-[var(--muted)]">画像をドロップ</div>
				<input id="fileInput" class="absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0" style="clip: rect(0, 0, 0, 0);" type="file" accept="image/jpeg,image/png" multiple />
				<div id="fileMeta" class="text-sm text-[var(--muted)] mt-3" aria-live="polite"></div>
			</div>
			<button id="pickBtn" class="hidden" type="button"></button>

			<div class="mt-8 flex flex-wrap items-center gap-6">
				<select id="formatSelect" class="border border-[var(--border)] rounded px-4 py-2 text-sm cursor-pointer bg-white">
					<option value="webp">WebP</option>
					<option value="avif">AVIF</option>
				</select>
				<div class="flex items-center gap-3">
					<span class="text-sm text-[var(--muted)]">品質</span>
					<input id="qualitySlider" type="range" min="0" max="100" value="80" class="w-32 h-1 bg-transparent cursor-pointer appearance-none" />
					<span id="qualityValue" class="text-sm text-[var(--text)] w-8">80</span>
				</div>
				<button id="convertBtn" class="flex items-center gap-2 border border-[var(--text)] bg-[var(--text)] text-white px-6 py-2 rounded text-sm hover:enabled:opacity-80 disabled:opacity-30 disabled:cursor-not-allowed transition-opacity" type="button" disabled>
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
					</svg>
					変換
				</button>
				<button id="downloadAllBtn" class="flex items-center gap-2 border border-[var(--border)] px-6 py-2 rounded text-sm hover:enabled:border-[var(--text)] disabled:opacity-30 disabled:cursor-not-allowed transition-colors" type="button" disabled>
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
					</svg>
					ZIP
				</button>
				<button id="clearBtn" class="flex items-center gap-2 text-sm text-[var(--muted)] hover:enabled:text-[var(--text)] disabled:opacity-30 disabled:cursor-not-allowed transition-colors" type="button" disabled>
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
					</svg>
					クリア
				</button>
			</div>

			<div class="mt-12">
				<div id="fileList" class="grid gap-4" aria-live="polite"></div>
				<div id="status" class="text-sm text-[var(--muted)] mt-6" aria-live="polite"></div>
				<div id="error" class="text-sm text-[var(--danger)] mt-4" role="alert"></div>
			</div>
		</section>
	</main>

	<script>
		import '../scripts/converter.ts';
	</script>
</Layout>

<style>
	/* Range Slider */
	input[type="range"]::-webkit-slider-track {
		height: 2px;
		background: var(--border);
		border-radius: 1px;
	}

	input[type="range"]::-moz-range-track {
		height: 2px;
		background: var(--border);
		border-radius: 1px;
	}

	input[type="range"]::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 14px;
		height: 14px;
		background: var(--text);
		border-radius: 50%;
		cursor: pointer;
	}

	input[type="range"]::-moz-range-thumb {
		width: 14px;
		height: 14px;
		background: var(--text);
		border-radius: 50%;
		border: none;
		cursor: pointer;
	}

	#dropzone.is-dragover {
		border-color: var(--text);
		background: var(--bg);
	}

	@keyframes spin {
		to {
			transform: rotate(360deg);
		}
	}

	.animate-spin {
		animation: spin 1s linear infinite;
	}
</style>
