---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<main class="page">
		<h1 class="title">Image Converter (JPG/PNG → WebP/AVIF)</h1>
		<p class="subtitle">すべてブラウザ内で変換します（サーバーアップロードなし）。</p>

		<section class="card">
			<div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="画像をドロップ または クリックして選択">
				<div class="dropzone__inner">
					<div class="dropzone__title">ここに JPG / PNG をドロップ（複数可）</div>
					<div class="dropzone__or">または</div>
					<button id="pickBtn" class="btn" type="button">ファイルを選択</button>
					<input id="fileInput" class="sr-only" type="file" accept="image/jpeg,image/png" multiple />
					<div id="fileMeta" class="meta" aria-live="polite"></div>
				</div>
			</div>

			<div class="controls">
				<label class="field">
					<span class="field__label">変換形式</span>
					<select id="formatSelect" class="select">
						<option value="webp">WebP</option>
						<option value="avif">AVIF</option>
					</select>
				</label>

				<label class="field">
					<span class="field__label">品質: <span id="qualityValue">80</span></span>
					<input id="qualitySlider" type="range" min="0" max="100" value="80" />
				</label>

				<div class="buttons">
					<button id="convertBtn" class="btn primary" type="button" disabled>一括変換</button>
					<button id="downloadAllBtn" class="btn" type="button" disabled>一括ダウンロード（ZIP）</button>
					<button id="clearBtn" class="btn" type="button" disabled>クリア</button>
				</div>
			</div>

			<div class="grid">
				<div class="panel">
					<h2 class="panel__title">ファイル</h2>
					<div id="fileList" class="filelist" aria-live="polite"></div>
				</div>
				<div class="panel">
					<h2 class="panel__title">ステータス</h2>
					<div id="status" class="status" aria-live="polite"></div>
					<div id="error" class="error" role="alert"></div>
				</div>
			</div>
		</section>
	</main>

	<script>
		import '../scripts/converter.ts';
	</script>
</Layout>

<style is:global>
	:root {
		color-scheme: light;
		--bg: #f6f7fb;
		--card: #ffffff;
		--muted: rgba(17, 24, 39, 0.68);
		--text: rgba(17, 24, 39, 0.92);
		--border: rgba(17, 24, 39, 0.14);
		--accent: #2563eb;
		--accent2: #0ea5e9;
		--danger: #b91c1c;
	}

	html,
	body {
		height: 100%;
	}

	body {
		margin: 0;
		font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
			"Segoe UI Emoji";
		color: var(--text);
	}

	.page {
		max-width: 980px;
		margin: 0 auto;
		padding: 40px 16px 64px;
	}

	.title {
		margin: 0 0 8px;
		font-size: 28px;
		letter-spacing: 0.2px;
	}

	.subtitle {
		margin: 0 0 20px;
		color: var(--muted);
	}

	.card {
		background: var(--card);
		border: 1px solid var(--border);
		border-radius: 16px;
		padding: 16px;
		box-shadow: 0 14px 50px rgba(17, 24, 39, 0.08);
	}

	.dropzone {
		border: 1px dashed rgba(17, 24, 39, 0.28);
		border-radius: 14px;
		padding: 18px;
		background: rgba(255, 255, 255, 0.8);
		cursor: pointer;
		outline: none;
	}

	.dropzone:focus-visible {
		box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.18);
		border-color: rgba(37, 99, 235, 0.7);
	}

	.dropzone.is-dragover {
		background: rgba(37, 99, 235, 0.06);
		border-color: rgba(37, 99, 235, 0.7);
	}

	.dropzone__inner {
		display: grid;
		gap: 10px;
		justify-items: start;
	}

	.dropzone__title {
		font-weight: 650;
	}

	.dropzone__or {
		color: var(--muted);
		font-size: 13px;
	}

	.meta {
		color: var(--muted);
		font-size: 13px;
	}

	.controls {
		margin-top: 14px;
		display: grid;
		gap: 12px;
	}

	.field {
		display: grid;
		gap: 6px;
	}

	.field__label {
		color: var(--muted);
		font-size: 13px;
	}

	.select,
	input[type="range"] {
		width: 100%;
	}

	.select {
		background: #ffffff;
		color: var(--text);
		border: 1px solid var(--border);
		border-radius: 10px;
		padding: 10px 12px;
	}

	.buttons {
		display: flex;
		flex-wrap: wrap;
		gap: 10px;
	}

	.btn {
		appearance: none;
		border: 1px solid var(--border);
		background: #ffffff;
		color: var(--text);
		padding: 10px 14px;
		border-radius: 12px;
		cursor: pointer;
		font-weight: 600;
	}

	.btn.primary {
		border-color: rgba(37, 99, 235, 0.5);
		background: rgba(37, 99, 235, 0.1);
	}

	.btn:disabled {
		opacity: 0.55;
		cursor: not-allowed;
	}

	.grid {
		margin-top: 16px;
		display: grid;
		grid-template-columns: 1fr;
		gap: 14px;
	}

	@media (min-width: 860px) {
		.grid {
			grid-template-columns: 1.3fr 0.7fr;
		}
	}

	.panel {
		border: 1px solid var(--border);
		border-radius: 14px;
		padding: 12px;
		background: rgba(255, 255, 255, 0.8);
	}

	.panel__title {
		margin: 0 0 10px;
		font-size: 14px;
		color: var(--muted);
		font-weight: 700;
	}

	.filelist {
		display: grid;
		gap: 10px;
	}

	.file {
		display: grid;
		grid-template-columns: 90px 1fr;
		gap: 10px;
		padding: 10px;
		border: 1px solid rgba(17, 24, 39, 0.12);
		border-radius: 12px;
		background: #ffffff;
	}

	.file__thumb {
		width: 90px;
		height: 64px;
		border-radius: 10px;
		border: 1px solid rgba(17, 24, 39, 0.12);
		background: rgba(17, 24, 39, 0.04);
		display: grid;
		place-items: center;
		overflow: hidden;
	}

	.file__thumb img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}

	.file__meta {
		display: grid;
		gap: 6px;
	}

	.file__name {
		font-weight: 700;
		font-size: 13px;
		line-height: 1.2;
		word-break: break-word;
	}

	.file__sub {
		color: var(--muted);
		font-size: 12px;
		white-space: pre-wrap;
		word-break: break-word;
	}

	.file__actions {
		display: flex;
		flex-wrap: wrap;
		gap: 8px;
	}

	.btn.small {
		padding: 8px 10px;
		border-radius: 10px;
		font-size: 12px;
	}

	.status {
		font-size: 13px;
		color: var(--muted);
		line-height: 1.6;
		white-space: pre-wrap;
		word-break: break-word;
	}

	.error {
		margin-top: 10px;
		font-size: 13px;
		color: var(--danger);
		white-space: pre-wrap;
	}

	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}
</style>
